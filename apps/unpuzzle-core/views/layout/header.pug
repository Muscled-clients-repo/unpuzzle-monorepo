//- Header Component with Right Sidebar User Panel
//- Usage: include header.pug with user and currentPath variables

- var currentPath = currentPath || '/'

//- Navigation configuration
- 
  var navigation = {
    student: [
      { name: 'Home', href: '/', iconClass: 'icon-home' },
      { name: 'Courses', href: '/courses', iconClass: 'icon-book-open' },
      { name: 'My Courses', href: '/my-courses', iconClass: 'icon-academic-cap' },
      { name: 'Puzzle Content', href: '/puzzle-content', iconClass: 'icon-puzzle' },
      { name: 'Settings', href: '/settings', iconClass: 'icon-cog' }
    ]
  }
  var variant = 'student'

header.bg-white.shadow-sm.border-b.border-gray-200.sticky.top-0.z-50#main-header
  .px-4.sm_px-6.lg_px-8
    .flex.h-16.items-center.justify-between
      //- Logo
      .flex.items-center
        a.flex.items-center.space-x-2(href="/")
          img.w-10.h-10(src=`${ASSET_ORIGIN}/img/logo.png` alt="Unpuzzle" width="40" height="40")
          span.text-2xl.font-bold.text-gray-900 Unpuzzle
      
      //- Desktop Navigation
      nav.hidden.md_flex.items-center.space-x-8#desktop-nav
        each item in navigation[variant]
          - var isActive = currentPath === item.href || (item.href !== '/' && currentPath.startsWith(item.href))
          - var activeClass = isActive ? 'text-blue-600 bg-blue-50' : 'text-gray-700 hover_text-blue-600 hover_bg-gray-50'
          a.flex.items-center.space-x-1.px-3.py-2.rounded-md.text-sm.font-medium.transition-colors(
            href=item.href
            class=activeClass
            data-nav-item
          )
            svg.h-4.w-4(class=item.iconClass)
              use(xlink:href=`#${item.iconClass}`)
            span= item.name
      
      //- Search Bar
      .hidden.lg_block.flex-1.max-w-md.mx-8
        form.relative#search-form
          input.w-full.pl-10.pr-4.py-2.border.border-gray-300.rounded-lg.focus_ring-2.focus_ring-blue-500.focus_border-transparent#search-input(
            type="text"
            placeholder="Search courses..."
            name="search"
          )
          svg.absolute.left-3.h-4.w-4.text-gray-400.icon-search(style="top: 50%; transform: translateY(-50%);")
            use(xlink:href="#icon-magnifying-glass")
      
      //- Right side - User Actions
      .flex.items-center.space-x-4
        //- Notifications
        button.relative.p-2.text-gray-400.hover_text-gray-500.focus_outline-none.focus_ring-2.focus_ring-blue-500.focus_ring-offset-2.rounded-full#notification-btn(
          type="button"
          aria-label="Notifications"
        )
          svg.h-6.w-6.icon-bell
            use(xlink:href="#icon-bell")
          span.absolute.top-0.right-0.block.h-2.w-2.rounded-full.bg-red-400.ring-2.ring-white#notification-indicator
        
        //- User Button
        #user-button-container
          if user
            //- Authenticated user - Profile button
            button.relative.flex.items-center.justify-center.w-10.h-10.bg-gray-100.rounded-full.hover_bg-gray-200.focus_outline-none.focus_ring-2.focus_ring-offset-2.focus_ring-blue-500.transition-colors#user-profile-btn(
              type="button"
              aria-label="User menu"
            )
              if user.image_url
                img.w-full.h-full.rounded-full.object-cover(src=user.image_url alt=user.firstName || "User")
              else
                .w-full.h-full.bg-blue-500.rounded-full.flex.items-center.justify-center
                  span.text-white.text-sm.font-medium= (user.firstName || user.email || 'U')[0].toUpperCase()
              //- Online indicator
              span.absolute.bottom-0.right-0.w-3.h-3.bg-green-400.border-2.border-white.rounded-full
          else
            //- Unauthenticated user - Sign in button
            a.inline-flex.items-center.px-4.py-2.border.border-transparent.text-sm.font-medium.rounded-md.text-white.bg-blue-600.hover_bg-blue-700(
              href="/sign-in"
            ) Sign in
        
        //- Mobile menu button
        button.block.md_hidden.p-2.rounded-md.text-gray-400.hover_text-gray-500.hover_bg-gray-100.focus_outline-none.focus_ring-2.focus_ring-blue-500#mobile-menu-toggle(
          type="button"
          aria-label="Toggle mobile menu"
        )
          svg.block.h-6.w-6.icon-bars#menu-open-icon
            use(xlink:href="#icon-bars")
          svg.hidden.h-6.w-6.icon-x#menu-close-icon
            use(xlink:href="#icon-x")
  
  //- Mobile menu
  #mobile-menu.md_hidden.hidden
    .px-2.pt-2.pb-3.space-y-1.sm_px-3.bg-white.border-t.border-gray-200
      //- Mobile Search
      .px-3.py-2
        form.relative#mobile-search-form
          input.w-full.pl-10.pr-4.py-2.border.border-gray-300.rounded-lg.focus_ring-2.focus_ring-blue-500.focus_border-transparent#mobile-search-input(
            type="text"
            placeholder="Search courses..."
            name="search"
          )
          svg.absolute.left-6.h-4.w-4.text-gray-400.icon-search(style="top: 50%; transform: translateY(-50%);")
            use(xlink:href="#icon-magnifying-glass")
      
      //- Mobile Navigation Links
      each item in navigation[variant]
        - var isActive = currentPath === item.href || (item.href !== '/' && currentPath.startsWith(item.href))
        - var activeClass = isActive ? 'text-blue-600 bg-blue-50' : 'text-gray-700 hover_text-blue-600 hover_bg-gray-50'
        a.flex.items-center.space-x-3.px-3.py-2.rounded-md.text-base.font-medium(
          href=item.href
          class=activeClass
          data-mobile-nav-item
        )
          svg.h-5.w-5(class=item.iconClass)
            use(xlink:href=`#${item.iconClass}`)
          span= item.name
      
      //- Mobile User Section
      .border-t.border-gray-200.pt-4.pb-3
        if user
          .flex.items-center.px-3
            .flex-shrink-0
              if user.image_url
                img.h-10.w-10.rounded-full(src=user.image_url alt=user.firstName || "User")
              else
                .h-10.w-10.rounded-full.bg-gray-300.flex.items-center.justify-center
                  span.text-lg.font-medium.text-gray-700= (user.firstName || 'U')[0].toUpperCase()
            .ml-3
              .text-base.font-medium.text-gray-800= user.firstName || user.email || 'User'
              .text-sm.font-medium.text-gray-500= user.email
          .mt-3.px-2.space-y-1
            a.block.px-3.py-2.rounded-md.text-base.font-medium.text-gray-700.hover_text-gray-900.hover_bg-gray-100(href="/profile") Your Profile
            a.block.px-3.py-2.rounded-md.text-base.font-medium.text-gray-700.hover_text-gray-900.hover_bg-gray-100(href="/settings") Settings
            button.block.w-full.text-left.px-3.py-2.rounded-md.text-base.font-medium.text-gray-700.hover_text-gray-900.hover_bg-gray-100#mobile-sign-out-btn(
              type="button"
            ) Sign out
        else
          .flex.items-center.px-3.space-x-3
            a.flex-1.text-center.bg-blue-600.hover_bg-blue-700.text-white.px-4.py-2.rounded-md.text-sm.font-medium(href="/sign-in") Sign in

//- Backdrop (hidden by default)
.fixed.inset-0.bg-black.bg-opacity-50.z-40.transition-opacity.hidden#sidebar-backdrop

//- Right Sidebar Panel (hidden by default)
.fixed.top-0.right-0.h-full.w-80.bg-white.shadow-xl.z-50.transform.transition-transform.duration-300.ease-in-out.translate-x-full#user-sidebar
  .h-full.flex.flex-col
    //- Header
    .px-6.py-4.border-b.border-gray-200
      .flex.items-center.justify-between
        h2.text-lg.font-semibold.text-gray-900 Profile
        button.p-2.text-gray-400.hover_text-gray-600.hover_bg-gray-100.rounded-lg.transition-colors#close-sidebar-btn(
          type="button"
          aria-label="Close sidebar"
        )
          svg.w-5.h-5(fill="none" stroke="currentColor" viewBox="0 0 24 24")
            path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12")
    
    //- User Info
    .flex-1.px-6.py-6
      .flex.flex-col.items-center
        //- Avatar
        .w-24.h-24.mb-4
          if user && user.image_url
            img.w-full.h-full.rounded-full.object-cover(src=user.image_url alt=user.firstName || "User")
          else if user
            .w-full.h-full.bg-blue-500.rounded-full.flex.items-center.justify-center
              span.text-white.text-2xl.font-medium= (user.firstName || user.email || 'U')[0].toUpperCase()
          else
            .w-full.h-full.bg-gray-300.rounded-full.flex.items-center.justify-center
              span.text-white.text-2xl.font-medium U
        
        if user
          //- Name
          h3.text-xl.font-semibold.text-gray-900.mb-1
            if user.firstName && user.lastName
              = `${user.firstName} ${user.lastName}`
            else if user.firstName
              = user.firstName
            else
              | User
          
          //- Email
          p.text-sm.text-gray-600.mb-4= user.email
          
          //- Role Badge
          if user.role
            .mb-6
              span.inline-flex.items-center.px-3.py-1.rounded-full.text-xs.font-medium.bg-blue-100.text-blue-800= user.role
          
          //- User Details
          .w-full.space-y-4.mb-8
            if user.id
              .flex.justify-between.items-center.py-2.border-b.border-gray-100
                span.text-sm.text-gray-500 User ID
                span.text-sm.font-medium.text-gray-900= user.id
            if user.created_at
              .flex.justify-between.items-center.py-2.border-b.border-gray-100
                span.text-sm.text-gray-500 Member since
                span.text-sm.font-medium.text-gray-900
                  - var date = new Date(user.created_at)
                  = date.toLocaleDateString()
    
    //- Footer
    .px-6.py-4.border-t.border-gray-200
      if user
        button.w-full.px-4.py-2.text-sm.font-medium.text-white.bg-red-600.rounded-md.hover_bg-red-700.focus_outline-none.focus_ring-2.focus_ring-offset-2.focus_ring-red-500.transition-colors#sidebar-sign-out-btn(
          type="button"
        ) Sign Out
      else
        a.block.w-full.text-center.px-4.py-2.text-sm.font-medium.text-white.bg-blue-600.rounded-md.hover_bg-blue-700(
          href="/sign-in"
        ) Sign In

//- SVG Icons Definition (hidden)
svg.hidden(xmlns="http://www.w3.org/2000/svg" style="display: none;")
  //- Home Icon
  symbol#icon-home(viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2")
    path(stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6")
  
  //- Book Open Icon
  symbol#icon-book-open(viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2")
    path(stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253")
  
  //- Academic Cap Icon
  symbol#icon-academic-cap(viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2")
    path(d="M12 14l9-5-9-5-9 5 9 5z")
    path(d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z")
    path(stroke-linecap="round" stroke-linejoin="round" d="M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222")
  
  //- Puzzle Icon
  symbol#icon-puzzle(viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2")
    path(stroke-linecap="round" stroke-linejoin="round" d="M14.121 14.121L19 19m-7-7l7 7m-7-7l-2.879 2.879M12 12L9.121 9.121m0 5.758a3 3 0 10-4.243 4.243 3 3 0 004.243-4.243zm0-5.758a3 3 0 10-4.243-4.243 3 3 0 004.243 4.243z")
  
  //- Cog Icon
  symbol#icon-cog(viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2")
    path(stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z")
    circle(cx="12" cy="12" r="3")
  
  //- Bell Icon
  symbol#icon-bell(viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2")
    path(stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9")
  
  //- Magnifying Glass Icon
  symbol#icon-magnifying-glass(viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2")
    path(stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z")
  
  //- Bars Icon (Menu)
  symbol#icon-bars(viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2")
    path(stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16")
  
  //- X Icon (Close)
  symbol#icon-x(viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2")
    path(stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12")