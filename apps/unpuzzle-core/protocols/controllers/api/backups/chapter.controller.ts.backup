import { NextFunction, Request, Response } from "express";
import ChapterModel from "../../../models/supabase/chapter.model"; // Adjust path as needed
import { randomUUID } from "crypto";
import { BindMethods } from "../../utility/BindMethods";
// import { Course } from "../../../types/Course.type";
import ResponseHandler from "../../utility/ResponseHandler";

class ChapterController {
  constructor(){

  }
  // Fetch all activity logs with pagination
  getAllChapters= async(req: any, res: Response, next:NextFunction)=>{
    const responseHandler = new ResponseHandler(res, next);
    const course_id = req.query.course_id;
    try {
      const result = await ChapterModel.getChaptersByCourse(course_id);
      if (!result) {
        const error= new Error("Unable to fetch activity logs. Please try again later.")
        return responseHandler.error(error)
      }
      return responseHandler.success(result)
    } catch (error: any) {
      return responseHandler.error(error)
    }
  }

  // Get activity log by ID
  getChapterById= async(req: Request, res: Response, next:NextFunction)=>{
    const responseHandler = new ResponseHandler(res, next);
    try {
      const result = await ChapterModel.getChapterById(req.params.id);
      if (!result) {
        const error= new Error("Unable to fetch activity logs. Please try again later.")
        return responseHandler.error(error)
      }
      return responseHandler.success(result)
    } catch (error: any) {
      return responseHandler.error(error)
    }
  }

  // Create a new activity log
  createChapter= async(req: any, res: Response, next:NextFunction)=>{
    const responseHandler = new ResponseHandler(res, next);
    try {
      let CourseData = req.body;
      if(CourseData.order_index){
        CourseData.order_index = parseInt(CourseData.order_index)
      }
      console.log(CourseData)
      const result = await ChapterModel.createChapter(CourseData);
      console.log(result)
      if (!result) {
        const error= new Error("Unable to create activity logs. Please try again later.")
        return responseHandler.error(error)
      }
      return responseHandler.success(result)
    } catch (error: any) {
      return responseHandler.error(error)
    }
  }

  // Update activity log by ID
  updateChapter= async(req: Request, res: Response, next:NextFunction)=>{
    const responseHandler = new ResponseHandler(res, next);
    try {
      const updates = req.body;
      const result = await ChapterModel.updateChapter(
        req.params.id,
        updates
      );
      if (!result) {
        const error= new Error("Unable to update activity logs. Please try again later.")
        return responseHandler.error(error)
      }
      return responseHandler.success(result)
    } catch (error: any) {
      return responseHandler.error(error)
    }
  }

  // Delete activity log by ID
  deleteChapter= async(req: Request, res: Response, next:NextFunction)=>{
    const responseHandler = new ResponseHandler(res, next);
    try {
      const result = await ChapterModel.deleteChapter(req.params.id);
      if (!result) {
        const error= new Error("Unable to delete activity logs. Please try again later.")
        return responseHandler.error(error)
      }
      return responseHandler.success(result)
    } catch (error: any) {
      return responseHandler.error(error)
    }
  }
}

const binding = new BindMethods(new ChapterController());
export default binding.bindMethods();
